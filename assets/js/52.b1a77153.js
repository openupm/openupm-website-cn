(window.webpackJsonp=window.webpackJsonp||[]).push([[52],{1130:function(t,a,e){"use strict";e.r(a);var s=e(30),n=Object(s.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"添加upm软件包"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#添加upm软件包"}},[t._v("#")]),t._v(" 添加UPM软件包")]),t._v(" "),s("h2",{attrs:{id:"upm软件包标准"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#upm软件包标准"}},[t._v("#")]),t._v(" UPM软件包标准")]),t._v(" "),s("p",[t._v("OpenUPM要求软件包满足以下条件：")]),t._v(" "),s("ul",[s("li",[t._v("软件包名称应该符合"),s("a",{attrs:{href:"https://docs.unity.cn/cn/2020.2/Manual/cus-naming.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("UPM命名约定"),s("OutboundLink")],1)]),t._v(" "),s("li",[t._v("软件包应该符合"),s("a",{attrs:{href:"https://unity3d.com/legal/terms-of-service/software",target:"_blank",rel:"noopener noreferrer"}},[t._v("Unity使用条例"),s("OutboundLink")],1),t._v("和"),s("a",{attrs:{href:"https://unity3d.com/legal/terms-of-service/software/package-guidelines",target:"_blank",rel:"noopener noreferrer"}},[t._v("软件包准则"),s("OutboundLink")],1),t._v("。")]),t._v(" "),s("li",[t._v("软件包应该提供其描述的功能，并被测试过。")]),t._v(" "),s("li",[t._v("包含软件包信息的"),s("code",[t._v("package.json")]),t._v("文件，可以放置根路径下或任意的子文件夹中。")]),t._v(" "),s("li",[t._v("软件包应该使用开源许可证。建议从"),s("a",{attrs:{href:"https://spdx.org/licenses/",target:"_blank",rel:"noopener noreferrer"}},[t._v("spdx许可证列表"),s("OutboundLink")],1),t._v("中选择。")]),t._v(" "),s("li",[t._v("软件包需要被托管在Github上。")]),t._v(" "),s("li",[t._v("软件包应该通过Git标签进行版本控制，且符合"),s("a",{attrs:{href:"https://semver.org/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Semantic Versioning 语义式版本"),s("OutboundLink")],1),t._v("的标准。例如"),s("code",[t._v("v1.1.0")]),t._v("，"),s("code",[t._v("1.1.0")]),t._v("，"),s("code",[t._v("1.1.1-preview")]),t._v("或"),s("code",[t._v("v2.0.0-preview.1")]),t._v("。建议使用"),s("a",{attrs:{href:"https://help.github.com/en/github/administering-a-repository/creating-releases",target:"_blank",rel:"noopener noreferrer"}},[t._v("GitHub发行"),s("OutboundLink")],1),t._v("页面或使用"),s("a",{attrs:{href:"https://medium.com/openupm/how-to-maintain-upm-package-part-2-f352fbf5f87c",target:"_blank",rel:"noopener noreferrer"}},[t._v("持续集成工具"),s("OutboundLink")],1),t._v("来创建含版本信息的Git标签。")]),t._v(" "),s("li",[t._v("软件包应该小于512MB。")])]),t._v(" "),s("h2",{attrs:{id:"upm代码仓库的文件结构"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#upm代码仓库的文件结构"}},[t._v("#")]),t._v(" UPM代码仓库的文件结构")]),t._v(" "),s("p",[t._v("OpenUPM构建管线支持以下三种主流的UPM代码仓库结构。")]),t._v(" "),s("ul",[s("li",[t._v("UPM软件包位于根路径下")]),t._v(" "),s("li",[t._v("UPM软件包位于子文件夹中")]),t._v(" "),s("li",[t._v("UPM软件包位于某一Git分支的子文件夹中")])]),t._v(" "),s("h3",{attrs:{id:"upm软件包位于根路径下"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#upm软件包位于根路径下"}},[t._v("#")]),t._v(" UPM软件包位于根路径下")]),t._v(" "),s("p",[s("code",[t._v("package.json")]),t._v(" 文件位于主分支的根路径，这是最简单的情况。")]),t._v(" "),s("h3",{attrs:{id:"upm软件包位于子文件夹中"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#upm软件包位于子文件夹中"}},[t._v("#")]),t._v(" UPM软件包位于子文件夹中")]),t._v(" "),s("p",[t._v("Git的主分支通常是一个Unity项目（带有Assets文件夹）。"),s("code",[t._v("package.json")]),t._v("文件位于子文件夹中, 例如"),s("code",[t._v("Assets/package-name")]),t._v("或者"),s("code",[t._v("Packages/com.namespace.package-name")]),t._v("。Git标签是基于主分支的。OpenUPM构建管线将检测"),s("code",[t._v("package.json")]),t._v("文件的位置，并对其进行正确处理。")]),t._v(" "),s("h3",{attrs:{id:"upm软件包位于某一git分支的子文件夹中"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#upm软件包位于某一git分支的子文件夹中"}},[t._v("#")]),t._v(" UPM软件包位于某一Git分支的子文件夹中")]),t._v(" "),s("p",[t._v("Git的主分支通常是一个Unity项目（带有Assets文件夹）。"),s("code",[t._v("package.json")]),t._v("文件位于子文件夹中，例如"),s("code",[t._v("Assets/package-name")]),t._v("或者"),s("code",[t._v("Packages/com.namespace.package-name")]),t._v("。该仓库另有一个"),s("code",[t._v("upm")]),t._v("分支，通常是使用"),s("code",[t._v("git subtree split/push")]),t._v("命令从主分支中修剪出的，目的是让"),s("code",[t._v("package.json")]),t._v("文件至于根目录下，并做一些特殊的准备工作（例如将"),s("code",[t._v("Samples")]),t._v("重命名为"),s("code",[t._v("Samples~")]),t._v("）。这样该"),s("code",[t._v("upm")]),t._v("分支就可以直接被Unity包管理器使用。这种结构下Git标签应基于upm分支，或者建立单独的"),s("code",[t._v("upm/x.y.z")]),t._v("Git标签，以便OpenUPM管线获取正确的信息。")]),t._v(" "),s("h2",{attrs:{id:"软件包yaml文件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#软件包yaml文件"}},[t._v("#")]),t._v(" 软件包YAML文件")]),t._v(" "),s("p",[t._v("OpenUPM使用YAML文件存储软件包的元信息。例如：")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 软件包名称")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" com.namespace.unitypackageexample\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 软件包显示名称")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("displayName")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Unity Package Example\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 软件包说明")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("description")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" An unity package example\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 代码仓库网址")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("repoUrl")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'https://github.com/author/reponame'")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 分叉的父代码仓库网址")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("parentRepoUrl")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token null important"}},[t._v("null")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# spdx许可证编号")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("licenseSpdxId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" MIT\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 许可证名称")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("licenseName")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" MIT License\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 主题标签列表")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("topics")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" utilities\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Git标签过滤前缀")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("gitTagPrefix")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("''")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Git标签忽略正则表达式")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("gitTagIgnore")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'-master$'")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 最小构建版本")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("minVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'1.0.5'")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 主图片")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'https://github.com/author/reponame/raw/master/path-of-img.png'")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 主图片缩放模式：cover (默认值) 或者 contain")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("imageFit")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" cover\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 自述路径")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("readme")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'master:README.md'")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 软件包猎手的GitHub用户名")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hunter")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" author\n")])])]),s("h2",{attrs:{id:"使用软件包提交表单"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用软件包提交表单"}},[t._v("#")]),t._v(" 使用软件包提交表单")]),t._v(" "),s("p",[t._v("软件包猎手可以使用"),s("RouterLink",{attrs:{to:"/packages/add/"}},[t._v("软件包提交表单")]),t._v("来提交软件包的YAML文件。该表单将指导你填写所需的信息，生成YAML文件，然后在浏览器中生成合并请求（Pull Request）并提交到GitHub。")],1),t._v(" "),s("p",[s("RouterLink",{attrs:{to:"/packages/add/"}},[s("img",{attrs:{src:e(820),alt:"软件包提交表单"}})])],1),t._v(" "),s("p",[t._v("通过自动测试后，该PR会被自动合并。CI会做大量集成工作，包括更新网站并通知构建管线。大约10~15分钟后，你可以通过访问"),s("code",[t._v("/packages/com.namespace.package-name")]),t._v("网址，来查看软件包的详细信息页面，并通过该页面的【"),s("strong",[t._v("版本")]),t._v("】和【"),s("strong",[t._v("构建管线")]),t._v("】模块了解更多的构建结果。")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("+--------------+      +--------------+      +---------+\n| Package Form | +--\x3e | Pull Request | +--\x3e | Wait CI |\n+--------------+      +--------------+      +---------+\n")])])]),s("h2",{attrs:{id:"故障排除"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#故障排除"}},[t._v("#")]),t._v(" 故障排除")]),t._v(" "),s("h3",{attrs:{id:"处理没有git标签的代码仓库"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#处理没有git标签的代码仓库"}},[t._v("#")]),t._v(" 处理没有Git标签的代码仓库")]),t._v(" "),s("p",[t._v("请在原作者的代码仓库中创建一个工单（Issue），以申请建立含有有效版本信息的Git标签。要了解如何使用GitHub Actions来自动化该过程，请参考"),s("a",{attrs:{href:"https://medium.com/openupm/how-to-maintain-upm-package-part-2-f352fbf5f87c",target:"_blank",rel:"noopener noreferrer"}},[t._v("这篇英文教程"),s("OutboundLink")],1),t._v("。")]),t._v(" "),s("h3",{attrs:{id:"处理主分支和upm分支的重复git标签"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#处理主分支和upm分支的重复git标签"}},[t._v("#")]),t._v(" 处理主分支和UPM分支的重复Git标签")]),t._v(" "),s("p",[t._v("代码仓库可能包含重复的版本标签。这可能是由CI工具创建的，一个用于主分支，另一个用于UPM分支。即")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("1.0.0")]),t._v("和"),s("code",[t._v("upm/1.1.0")])]),t._v(" "),s("li",[s("code",[t._v("1.0.0")]),t._v("和"),s("code",[t._v("1.1.0-upm")])]),t._v(" "),s("li",[s("code",[t._v("1.0.0-master")]),t._v("和"),s("code",[t._v("1.1.0-upm")])])]),t._v(" "),s("p",[t._v("在这种情况下，来自UPM分支的标签具有更高的优先级，而另一个则被忽略。")]),t._v(" "),s("h3",{attrs:{id:"处理失败的构建"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#处理失败的构建"}},[t._v("#")]),t._v(" 处理失败的构建")]),t._v(" "),s("p",[t._v("你可以在软件包详细信息页面上的【"),s("strong",[t._v("构建管线")]),t._v("】部分检查失败的原因。最常见的问题是"),s("strong",[t._v("版本冲突/版本已存在")]),t._v("，这意味着你已经发布了具有相同版本号的软件包。这通常是由于忘记更新"),s("code",[t._v("package.json")]),t._v("文件的版本号造成的。软件包的作者需要更新该版本号，然后重新标记错误的Git标签。若OpenUPM检测到相关的Git标签已被重新标记，则构建管线将重新构建失败的版本。")]),t._v(" "),s("p",[t._v("然而，构建管线不会去重建已经成功发布的版本，即使是对应的Git标签被重新标记或删除。因为更改已经发行的版本是一种不被鼓励的行为，特别对于开放的软件仓库来说更是如此。如果打算修复一个Bug，建议软件包的作者通过提升版本号，并创建新的Git标签来修复该问题。")]),t._v(" "),s("h3",{attrs:{id:"处理复合软件包仓库-monorepos"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#处理复合软件包仓库-monorepos"}},[t._v("#")]),t._v(" 处理复合软件包仓库（Monorepos）")]),t._v(" "),s("p",[t._v("复合软件包仓库（Monorepos）在单个代码仓库中包含多个软件包。通常结构如下：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("Packages/\n  com.namespace.foo/\n    package.json\n  com.namespace.bar/\n    package.json\n")])])]),s("p",[t._v("复合软件包仓库（Monorepos）应提交多个软件包YAML到OpenUPM平台中。需要注意的是，")]),t._v(" "),s("ul",[s("li",[t._v("如果你为每个新版本，都提升所有软件包的版本号。那么它将可以正常工作。我们的构建管线将分别处理每个程序包提交，并找到相关的package.json进行处理。")]),t._v(" "),s("li",[t._v("如果你为某个单独的软件包发布新版本，但其他的软件包版本则保持不动，你需要使用一个Git标记的前缀来区分每个软件包。例如"),s("code",[t._v("com.namespace.bar/1.0.0")]),t._v("和"),s("code",[t._v("com.namespace.foo/1.0.0")]),t._v("。然后填写软件包YAML文件的"),s("code",[t._v("gitTagPrefix")]),t._v("字段。例如，软件包"),s("code",[t._v("com.namespace.bar")]),t._v("应该写入"),s("code",[t._v('gitTagPrefix: "com.namespace.bar/"')]),t._v("，以避免浪费构建管线的资源去构建实际上未更新的软件包。")])])])}),[],!1,null,null,null);a.default=n.exports},820:function(t,a,e){t.exports=e.p+"assets/img/package-add-form.7752681a.png"}}]);
(window.webpackJsonp=window.webpackJsonp||[]).push([[58],{1120:function(e,t,a){"use strict";a.r(t);var r=a(30),s=Object(r.a)({},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h1",{attrs:{id:"development"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#development"}},[e._v("#")]),e._v(" Development")]),e._v(" "),a("h2",{attrs:{id:"architecture"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#architecture"}},[e._v("#")]),e._v(" Architecture")]),e._v(" "),a("p",[e._v("The OpenUPM service is composed of below sub-systems:")]),e._v(" "),a("ul",[a("li",[e._v("Public upm registry")]),e._v(" "),a("li",[e._v("*Automatic build pipelines")]),e._v(" "),a("li",[e._v("*Website frontend")]),e._v(" "),a("li",[e._v("*Website backend (API)")]),e._v(" "),a("li",[e._v("*Package curated list")]),e._v(" "),a("li",[a("a",{attrs:{href:"https://github.com/openupm/openupm-cli",target:"_blank",rel:"noopener noreferrer"}},[e._v("OpenUPM-CLI"),a("OutboundLink")],1),e._v(" command-line tool")])]),e._v(" "),a("p",[e._v("Entries with "),a("code",[e._v("*")]),e._v(" prefix are located in the "),a("a",{attrs:{href:"https://github.com/openupm/openupm",target:"_blank",rel:"noopener noreferrer"}},[e._v("main repository"),a("OutboundLink")],1),e._v(".")]),e._v(" "),a("h2",{attrs:{id:"directory-structure"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#directory-structure"}},[e._v("#")]),e._v(" Directory Structure")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v(".\n├── app         # service backend\n│   ├── db         # database, Redis\n│   ├── jobs       # background jobs\n│   ├── models     # models\n│   ├── queues     # job queues\n│   ├── utils      # useful scripts\n│   └── views      # HTTP endpoints\n├── config       # configurations\n├── data         # data\n│   └── packages # package curated list (YAML files)\n├── docs         # web frontend (vuepress)\n└── tests        # unit tests\n")])])]),a("h2",{attrs:{id:"public-upm-registry"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#public-upm-registry"}},[e._v("#")]),e._v(" Public UPM Registry")]),e._v(" "),a("p",[e._v("OpenUPM uses a custom verdaccio to host the registry. Though verdaccio is the most popular open-source project to set up a private npm registry, most deployments served a very limited user base or for the testing purpose that doesn't care about performance much. OpenUPM try to solve quite a few issues related to the cluster deployment. Before these PRs get merged, OpenUPM will stay with the custom build:")]),e._v(" "),a("ul",[a("li",[e._v("S3 storage with CDN "),a("a",{attrs:{href:"https://github.com/verdaccio/monorepo/issues/250",target:"_blank",rel:"noopener noreferrer"}},[e._v("#250"),a("OutboundLink")],1)]),e._v(" "),a("li",[e._v("Stateless s3 storage for cluster deployment "),a("a",{attrs:{href:"https://github.com/verdaccio/verdaccio/issues/1595",target:"_blank",rel:"noopener noreferrer"}},[e._v("#1595"),a("OutboundLink")],1),e._v(", "),a("a",{attrs:{href:"https://github.com/verdaccio/verdaccio/issues/1459",target:"_blank",rel:"noopener noreferrer"}},[e._v("#1459"),a("OutboundLink")],1)]),e._v(" "),a("li",[e._v("Commands "),a("code",[e._v("npm publish -f")]),e._v(" and "),a("code",[e._v("npm unpublish")]),e._v(" return 404 "),a("s",[a("a",{attrs:{href:"https://github.com/verdaccio/verdaccio/issues/1435",target:"_blank",rel:"noopener noreferrer"}},[e._v("#1435"),a("OutboundLink")],1)])]),e._v(" "),a("li",[e._v("Wrong timestamp for old search API "),a("s",[a("a",{attrs:{href:"https://github.com/verdaccio/verdaccio/issues/1597",target:"_blank",rel:"noopener noreferrer"}},[e._v("#1597"),a("OutboundLink")],1)])])]),e._v(" "),a("p",[e._v("Since OpenUPM has it's own way to organize the package list, the verdaccio website and API endpoints are disabled (headless mode).")]),e._v(" "),a("h2",{attrs:{id:"automatic-build-pipelines"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#automatic-build-pipelines"}},[e._v("#")]),e._v(" Automatic Build Pipelines")]),e._v(" "),a("p",[e._v("OpenUPM watches the package curated list regularly detects new contents and uses the job queue to build packages through "),a("a",{attrs:{href:"https://azure.microsoft.com/en-us/services/devops/pipelines/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Azure Pipelines"),a("OutboundLink")],1),e._v(".")]),e._v(" "),a("h3",{attrs:{id:"cronjob"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#cronjob"}},[e._v("#")]),e._v(" Cronjob")]),e._v(" "),a("p",[e._v("OpenUPM uses pm2 cron feature to run cronjobs.")]),e._v(" "),a("table",[a("thead",[a("tr",[a("th",[e._v("Job")]),e._v(" "),a("th",[e._v("Description")]),e._v(" "),a("th",{staticStyle:{"text-align":"right"}},[e._v("GitHub Reset API")]),e._v(" "),a("th",{staticStyle:{"text-align":"right"}},[e._v("GitHub GraphQL API")])])]),e._v(" "),a("tbody",[a("tr",[a("td",[e._v("add-build-package-job")]),e._v(" "),a("td",[e._v("add build-pkg to the job queue.")]),e._v(" "),a("td",{staticStyle:{"text-align":"right"}}),e._v(" "),a("td",{staticStyle:{"text-align":"right"}})]),e._v(" "),a("tr",[a("td",[e._v("fetch-package-extra")]),e._v(" "),a("td",[e._v("fetch package README, stars, ogimage")]),e._v(" "),a("td",{staticStyle:{"text-align":"right"}},[e._v("n")]),e._v(" "),a("td",{staticStyle:{"text-align":"right"}},[e._v("2n")])]),e._v(" "),a("tr",[a("td",[e._v("aggregate-package-extra")]),e._v(" "),a("td",[e._v("aggregate package extra")]),e._v(" "),a("td",{staticStyle:{"text-align":"right"}}),e._v(" "),a("td",{staticStyle:{"text-align":"right"}})]),e._v(" "),a("tr",[a("td",[e._v("update-recent-packages")]),e._v(" "),a("td",[e._v("update recent updated packages")]),e._v(" "),a("td",{staticStyle:{"text-align":"right"}}),e._v(" "),a("td",{staticStyle:{"text-align":"right"}})]),e._v(" "),a("tr",[a("td",[e._v("fetch-site-info")]),e._v(" "),a("td",[e._v("fetch repo stars")]),e._v(" "),a("td",{staticStyle:{"text-align":"right"}},[e._v("1")]),e._v(" "),a("td",{staticStyle:{"text-align":"right"}})]),e._v(" "),a("tr",[a("td",[e._v("update-feeds")]),e._v(" "),a("td",[e._v("update RSS feeds")]),e._v(" "),a("td",{staticStyle:{"text-align":"right"}}),e._v(" "),a("td",{staticStyle:{"text-align":"right"}})])])]),e._v(" "),a("h3",{attrs:{id:"job-queue"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#job-queue"}},[e._v("#")]),e._v(" Job Queue")]),e._v(" "),a("p",[e._v("OpenUPM uses "),a("a",{attrs:{href:"https://github.com/bee-queue/bee-queue",target:"_blank",rel:"noopener noreferrer"}},[e._v("Bee-Queue"),a("OutboundLink")],1),e._v(" to manage the job queue.")]),e._v(" "),a("table",[a("thead",[a("tr",[a("th",[e._v("Job")]),e._v(" "),a("th",[e._v("Description")]),e._v(" "),a("th",{staticStyle:{"text-align":"right"}},[e._v("GitHub API")])])]),e._v(" "),a("tbody",[a("tr",[a("td",[a("code",[e._v("build-pkg:<pkg>")])]),e._v(" "),a("td",[e._v("fetch repo info and create build-rel jobs for valid Git tags")]),e._v(" "),a("td",{staticStyle:{"text-align":"right"}},[e._v("0")])]),e._v(" "),a("tr",[a("td",[a("code",[e._v("build-rel:<pkg>:<ver>")])]),e._v(" "),a("td",[e._v("build pkg@version via Azure Pipelines")]),e._v(" "),a("td",{staticStyle:{"text-align":"right"}},[e._v("0")])])])]),e._v(" "),a("h3",{attrs:{id:"github-rate-limit"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#github-rate-limit"}},[e._v("#")]),e._v(" GitHub Rate Limit")]),e._v(" "),a("p",[e._v("Print the "),a("a",{attrs:{href:"https://docs.github.com/en/free-pro-team@latest/rest/reference/rate-limit",target:"_blank",rel:"noopener noreferrer"}},[e._v("rate limit"),a("OutboundLink")],1),e._v(" status.")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("yarn gh:ratelimit\n")])])]),a("h2",{attrs:{id:"website-frontend"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#website-frontend"}},[e._v("#")]),e._v(" Website Frontend")]),e._v(" "),a("p",[e._v("OpenUPM uses "),a("a",{attrs:{href:"https://vuepress.vuejs.org",target:"_blank",rel:"noopener noreferrer"}},[e._v("VuePress"),a("OutboundLink")],1),e._v(" - a static website generator to develop website frontend.")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("source")]),e._v(" env.sh\n"),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("yarn")]),e._v(" docs:dev\n")])])]),a("p",[e._v("To enable webpack bundle analyzer:")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("WEBPACK_BUNDLE_ANALYZER")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("yarn")]),e._v(" docs:build\n")])])]),a("h2",{attrs:{id:"website-backend"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#website-backend"}},[e._v("#")]),e._v(" Website Backend")]),e._v(" "),a("p",[e._v("OpenUPM uses "),a("a",{attrs:{href:"http://expressjs.com/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Express"),a("OutboundLink")],1),e._v(" to develop website backend (API).")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[e._v("yarn")]),e._v(" server:dev\n")])])]),a("h2",{attrs:{id:"package-curated-list"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#package-curated-list"}},[e._v("#")]),e._v(" Package Curated List")]),e._v(" "),a("p",[e._v("OpenUPM uses git as a database to maintain the package curated list. Each package is described as a YAML file.")]),e._v(" "),a("h2",{attrs:{id:"i18n"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#i18n"}},[e._v("#")]),e._v(" i18n")]),e._v(" "),a("p",[e._v("The website supports two regions with different configurations:")]),e._v(" "),a("table",[a("thead",[a("tr",[a("th",[e._v("Region")]),e._v(" "),a("th",[e._v("Language")]),e._v(" "),a("th",[e._v("Fallback Language")])])]),e._v(" "),a("tbody",[a("tr",[a("td",[e._v("US")]),e._v(" "),a("td",[e._v("en-US")]),e._v(" "),a("td",[e._v("n/a")])]),e._v(" "),a("tr",[a("td",[e._v("CN")]),e._v(" "),a("td",[e._v("zh-CN")]),e._v(" "),a("td",[e._v("en-US")])])])]),e._v(" "),a("ul",[a("li",[a("p",[e._v("The documentation level translations are located at "),a("code",[e._v("docs/zh")]),e._v(".")])]),e._v(" "),a("li",[a("p",[e._v("The component level translations are located at "),a("code",[e._v("docs/.vuepress/locales")]),e._v(". "),a("a",{attrs:{href:"https://github.com/antfu/i18n-ally",target:"_blank",rel:"noopener noreferrer"}},[e._v("i18n-ally"),a("OutboundLink")],1),e._v(" is powerful i18n extensions for VS Code to edit locale files.")])]),e._v(" "),a("li",[a("p",[e._v("To develop the CN region:")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("OPENUPM_REGION=cn yarn docs:dev\n")])])])])])])}),[],!1,null,null,null);t.default=s.exports}}]);